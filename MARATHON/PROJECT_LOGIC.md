# Логика работы сайта FlavorFit

## 1️⃣ Рецепты — источник потребностей

### Что видит пользователь

- Пользователь открывает рецепт
- Видит:
  - список ингредиентов
  - количество и единицу измерения (например, `2 PIECE`, `100 GRAM`)
  - шаги приготовления
- Может добавить рецепт в список покупок

### Логика

- **Рецепт описывает, _что нужно для приготовления блюда_, а не что покупать в магазине**
- Ингредиент рецепта:
  - ссылается на абстрактный продукт (например, «Сахар»)
  - содержит количество и единицу измерения
  - не знает ничего о цене, фасовке или упаковке

Пример:

> Сахар — 2 чайные ложки

Это кулинарная потребность, а не торговая позиция.

---

## 2️⃣ Продукты — каталог того, что можно купить

### Что видит пользователь

- Каталог товаров:
  - Сахар
  - Молоко
  - Фарш
- У каждого товара может быть несколько вариантов покупки

### Логика

- **Product** — это абстрактный товар:
  - используется в рецептах
  - имеет базовую единицу измерения (GRAM, PIECE и т.д.)

- **ProductVariant** — это конкретный способ покупки товара:
  - фасовка
  - цена
  - описание

Один продукт может иметь несколько вариантов покупки (1 кг, 500 г, упаковка и т.д.).

---

## 3️⃣ Список покупок — агрегатор потребностей

### Что видит пользователь

- Пользователь добавляет один или несколько рецептов
- Получает единый список покупок, например:
  - Морковь — 4 PIECE
  - Сахар — 150 GRAM
  - Фарш — 500 GRAM

### Логика

- Список покупок:
  - объединяет ингредиенты из разных рецептов
  - складывает одинаковые продукты
  - всё ещё не работает с ценами и фасовками

Если несколько рецептов используют один и тот же продукт — потребности суммируются.

### Источники потребностей

Для каждой позиции списка хранится информация:

- из каких рецептов она сформирована
- какое количество внёс каждый рецепт

Это позволяет:

- корректно удалять рецепты из списка
- объяснять пользователю, почему требуется именно такое количество продукта

---

## 4️⃣ Корзина — выбор способа покупки

### Что видит пользователь

- Пользователь открывает список покупок
- Для каждого продукта выбирает:
  - вариант покупки (фасовку)
  - количество упаковок
- Видит итоговую цену

### Логика

- Корзина — это переход от **кулинарной логики к торговой**
- Здесь появляются:
  - цена
  - упаковка
  - пересчёт количества

Корзина работает не с рецептами, а с:

- продуктами
- вариантами продукта
- выбранным количеством

Каждая позиция корзины знает, какие строки списка покупок она закрывает.

---

## 5️⃣ Заказ — зафиксированный результат

### Что видит пользователь

- Пользователь оформляет заказ
- После оформления заказ не меняется

### Логика

- При создании заказа:
  - данные из корзины копируются в заказ
  - фиксируются цена, единицы измерения и названия

Даже если позже:

- изменится цена
- удалят товар
- изменится рецепт

заказ остаётся неизменным.

**Заказ — это исторический снимок состояния корзины на момент покупки.**

---

## Итоговая цепочка

```text
Recipe
  ↓
ShoppingList (агрегация потребностей)
  ↓
Cart (выбор способа покупки)
  ↓
Order (immutable snapshot)
```

Эта цепочка разделяет:

- приготовление еды
- планирование покупок
- покупку
- историю заказов

и позволяет системе оставаться устойчивой к изменениям данных со временем.
