model Recipe {
  recipeId    String @id @default(cuid()) @map("recipe_id")
  slug        String @unique
  title       String
  description String

  calories    Int?
  cookingTime Int?       @map("cooking_time")
  difficulty  Difficulty
  dishType    DishType

  // increases only when ingredients change
  ingredientsVersion Int @default(1) @map("ingredients_version")

  ingredients Ingredient[]
  recipeSteps RecipeStep[]

  tags           RecipeTag[]
  nutritionFacts NutritionFact?

  user   User   @relation(fields: [userId], references: [userId])
  userId String @map("user_id")

  comments Comment[]
  likes    Like[]
  views    Int       @default(0)

  listRecipes     ShoppingListRecipe[]
  listItemSources ShoppingListItemSource[]
  orderRecipes    OrderRecipe[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("recipes")
}

model Ingredient {
  ingredientId String     @id @default(cuid()) @map("ingredient_id")
  quantity     Decimal    @db.Decimal(10, 3)
  recipeUnit   RecipeUnit @map("recipe_unit")

  note String? //3â€“4 depending on size

  recipe   Recipe @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
  recipeId String @map("recipe_id")

  product   Product @relation(fields: [productId], references: [productId])
  productId String  @map("product_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([recipeId, productId]) // one ingredient - once in the recipe
  @@map("ingredients")
}

model RecipeStep {
  recipeStepId String  @id @default(cuid()) @map("recipe_steps_id")
  stepNumber   Int?    @map("step_number")
  title        String?
  content      String

  recipe   Recipe @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)
  recipeId String @map("recipe_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([recipeId, stepNumber])
  @@map("recipe_steps")
}

model NutritionFact {
  factId String @id @default(cuid()) @map("fact_id")

  protein       Decimal?
  fats          Decimal?
  carbohydrates Decimal?
  fiber         Decimal?

  recipeId String @unique @map("recipe_id")
  recipe   Recipe @relation(fields: [recipeId], references: [recipeId], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("nutrition_facts")
}

model RecipeTag {
  tagId   String @id @default(cuid()) @map("tag_id")
  tagName String @unique @map("tag_name")

  recipes Recipe[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("recipe_tags")
}
